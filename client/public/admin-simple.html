<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Basit</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .login-form { max-width: 400px; margin: 50px auto; }
        .admin-panel { display: none; }
        button { padding: 12px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        .team-member { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="login-form">
            <h2>Admin Giriş</h2>
            <input type="text" id="username" placeholder="Kullanıcı Adı" value="admin">
            <input type="password" id="password" placeholder="Şifre" value="a123">
            <button onclick="login()">Giriş Yap</button>
            <div id="loginMessage"></div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1>Takım Yönetimi</h1>
                <button onclick="logout()">Çıkış Yap</button>
            </div>
            
            <div id="teamMembers">
                <!-- Team members will be loaded here -->
            </div>
            
            <div id="message"></div>
        </div>
    </div>

    <script>
        let adminToken = null;
        
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageEl = document.getElementById('loginMessage');
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    adminToken = data.token;
                    localStorage.setItem('adminToken', adminToken);
                    
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    
                    loadTeamMembers();
                } else {
                    const error = await response.json();
                    messageEl.innerHTML = '<div class="message error">Hata: ' + error.message + '</div>';
                }
            } catch (error) {
                messageEl.innerHTML = '<div class="message error">Bağlantı hatası: ' + error.message + '</div>';
            }
        }
        
        function logout() {
            adminToken = null;
            localStorage.removeItem('adminToken');
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        async function loadTeamMembers() {
            const teamData = [
                { id: "1", name: "Yıldırım Özyakışır", position: "Proje Yöneticisi", positionEn: "Project Manager", email: "yildirim@algotrom.com.tr" },
                { id: "2", name: "İsmet Çetin", position: "Proje Yöneticisi", positionEn: "Project Manager", email: "ismet@algotrom.com.tr" },
                { id: "3", name: "Sedef Nihal", position: "Finans Yöneticisi", positionEn: "Finance Manager", email: "sedef@algotrom.com.tr" }
            ];
            
            const container = document.getElementById('teamMembers');
            container.innerHTML = '';
            
            teamData.forEach(member => {
                const memberEl = document.createElement('div');
                memberEl.className = 'team-member';
                memberEl.innerHTML = `
                    <h3>${member.name}</h3>
                    <p><strong>Pozisyon (TR):</strong> <input type="text" id="pos_${member.id}" value="${member.position}"></p>
                    <p><strong>Pozisyon (EN):</strong> <input type="text" id="posEn_${member.id}" value="${member.positionEn}"></p>
                    <p><strong>E-posta:</strong> <input type="text" id="email_${member.id}" value="${member.email}"></p>
                    <button onclick="saveMember('${member.id}')">Kaydet</button>
                `;
                container.appendChild(memberEl);
            });
        }
        
        async function saveMember(memberId) {
            const data = {
                id: memberId,
                position: document.getElementById(`pos_${memberId}`).value,
                positionEn: document.getElementById(`posEn_${memberId}`).value,
                email: document.getElementById(`email_${memberId}`).value
            };
            
            try {
                const response = await fetch(`/api/admin/team/${memberId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                const messageEl = document.getElementById('message');
                
                if (response.ok) {
                    const result = await response.json();
                    messageEl.innerHTML = '<div class="message success">Kayıt başarılı! Not: Değişikliklerin statik HTML sitesinde görünmesi için manuel güncelleme gerekiyor.</div>';
                } else {
                    const error = await response.json();
                    messageEl.innerHTML = '<div class="message error">Hata: ' + error.message + '</div>';
                }
            } catch (error) {
                document.getElementById('message').innerHTML = '<div class="message error">Bağlantı hatası: ' + error.message + '</div>';
            }
        }
        
        // Check if already logged in
        window.onload = function() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                adminToken = token;
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadTeamMembers();
            }
        };
    </script>
</body>
</html>